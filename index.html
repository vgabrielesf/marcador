<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Modelo 3D AR - 1.glb</title>
    
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    
    <!-- AR.js -->
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.min.js"></script>
    
    <style>
        body { margin: 0; font-family: Arial, sans-serif; background: #000; }
        
        #info {
            position: fixed; top: 10px; left: 10px; right: 10px;
            background: rgba(0, 0, 0, 0.9); color: white;
            padding: 15px; border-radius: 10px; z-index: 9999;
            font-size: 13px; text-align: center; border: 2px solid #00ff88;
        }
        
        #info h3 { margin: 0 0 10px 0; color: #00ff88; }
        .hide { display: none; }
        button { 
            background: #ff4444; color: white; border: none;
            padding: 10px 16px; border-radius: 5px; margin: 5px; cursor: pointer;
            font-size: 12px;
        }
        .success { background: #28a745 !important; }
        .warning { background: #ffc107 !important; color: black !important; }
        .info { background: #17a2b8 !important; }
    </style>
</head>
<body>
    
    <div id="info">
        <h3>üéÆ AR Modelo 1.glb</h3>
        <p>Formato GLTF - Funciona perfeitamente!</p>
        <button class="success" onclick="testCamera()">üìπ Testar C√¢mera</button>
        <button class="warning" onclick="showInstructions()">üìã Instru√ß√µes</button>
        <button class="info" onclick="showMarker()">üéØ Ver Marcador</button>
        <button onclick="showConverter()">üîÑ Converter FBX</button>
    </div>

    <!-- Cena AR -->
    <a-scene 
        arjs='sourceType: webcam; trackingMethod: best; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: false;' 
        embedded
        vr-mode-ui="enabled: false"
        loading-screen="enabled: false;">
        
        <!-- Assets -->
        <a-assets timeout="30000">
            <!-- Modelo GLTF Principal -->
            <a-asset-item id="gltf-model" src="./1.glb" crossorigin="anonymous"></a-asset-item>
            
            <!-- Modelo de demonstra√ß√£o (fallback) -->
            <a-asset-item id="demo-model" src="https://cdn.glitch.com/36cb8393-65c6-408d-a538-055ada20431b%2Fduck.gltf?1527873511517" crossorigin="anonymous"></a-asset-item>
        </a-assets>
        
        <a-marker preset='hiro' id="hiro-marker">
            
            <!-- Container principal do modelo -->
            <a-entity id="model-container" position="0 0 0">
                
                <!-- Modelo GLTF Principal -->
                <a-entity 
                    id="gltf-entity"
                    gltf-model="src: #gltf-model"
                    position="0 0 0" 
                    rotation="0 0 0" 
                    scale="1 1 1"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 20000;"
                    visible="true">
                </a-entity>
                
                <!-- Modelo de demonstra√ß√£o (fallback) -->
                <a-entity 
                    id="demo-entity"
                    gltf-model="src: #demo-model"
                    position="0 0 0" 
                    rotation="0 0 0" 
                    scale="0.02 0.02 0.02"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 10000;"
                    visible="false">
                    
                    <!-- Texto explicativo -->
                    <a-text 
                        value="CONVERTA\nSEU FBX\nPARA GLB" 
                        position="0 30 0" 
                        align="center" 
                        color="#ffff00" 
                        scale="15 15 15">
                    </a-text>
                </a-entity>
                
                <!-- Cubo de fallback (√∫ltimo recurso) -->
                <a-box 
                    id="fallback-cube"
                    position="0 0.5 0" 
                    scale="0.8 0.8 0.8" 
                    color="#FF6B6B"
                    material="metalness: 0.3; roughness: 0.4;"
                    animation="property: rotation; to: 360 360 360; loop: true; dur: 8000;"
                    visible="false">
                    
                    <a-text 
                        value="1.glb\nNAO\nENCONTRADO" 
                        position="0 0 0.51" 
                        align="center" 
                        color="white" 
                        scale="0.4 0.4 0.4">
                    </a-text>
                </a-box>
                
            </a-entity>
            
            <!-- Ilumina√ß√£o otimizada para modelos 3D -->
            <a-light type="ambient" color="#404040" intensity="0.6"></a-light>
            <a-light type="directional" position="2 4 2" color="white" intensity="1"></a-light>
            <a-light type="point" position="-2 2 2" color="#4ECDC4" intensity="0.4"></a-light>
            <a-light type="point" position="2 2 -2" color="#FFB6C1" intensity="0.3"></a-light>
            
        </a-marker>
        
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        let modelLoaded = false;
        let cameraWorking = false;
        let markerFound = false;
        
        function hideInfo() {
            document.getElementById('info').classList.add('hide');
        }
        
        function showMarker() {
            window.open('marcador.html', '_blank');
        }
        
        function showInstructions() {
            document.getElementById('info').innerHTML = `
                <h3>üìã Como usar seu Modelo 1.glb:</h3>
                <p><strong>1. Arquivo necess√°rio:</strong></p>
                <ul style="text-align: left; font-size: 11px;">
                    <li>‚úÖ Arquivo "1.glb" deve estar no reposit√≥rio</li>
                    <li>‚úÖ Nome exato: <strong>1.glb</strong> (formato GLTF)</li>
                    <li>‚úÖ Muito mais r√°pido que FBX</li>
                </ul>
                <p><strong>2. Como usar:</strong></p>
                <ul style="text-align: left; font-size: 11px;">
                    <li>üìπ Teste a c√¢mera primeiro</li>
                    <li>üéØ Use o marcador Hiro</li>
                    <li>üì± Aponte o celular para o marcador</li>
                </ul>
                <button onclick="testCamera()">üìπ Testar</button>
                <button onclick="showMarker()">üéØ Marcador</button>
                <button onclick="showConverter()">üîÑ Converter FBX</button>
                <button onclick="hideInfo()">‚ú® AR</button>
            `;
        }
        
        function showConverter() {
            document.getElementById('info').innerHTML = `
                <h3>üîÑ Converter FBX ‚Üí GLTF:</h3>
                
                <p><strong>BLENDER (Gr√°tis):</strong></p>
                <ol style="text-align: left; font-size: 11px;">
                    <li>Baixe: blender.org</li>
                    <li>File ‚Üí Import ‚Üí FBX (.fbx)</li>
                    <li>Selecione seu 1.fbx</li>
                    <li>File ‚Üí Export ‚Üí glTF 2.0 (.glb)</li>
                    <li>Salve como "1.glb"</li>
                    <li>Upload no GitHub</li>
                </ol>
                
                <p><strong>ONLINE:</strong></p>
                <ul style="text-align: left; font-size: 11px;">
                    <li>products.aspose.app/3d/conversion</li>
                    <li>Upload 1.fbx ‚Üí Baixe 1.glb</li>
                </ul>
                
                <button onclick="showInstructions()">üîô Voltar</button>
                <button onclick="hideInfo()">OK</button>
            `;
        }
        
        async function testCamera() {
            const infoDiv = document.getElementById('info');
            try {
                infoDiv.innerHTML = '<h3>üîç Testando c√¢mera...</h3><p>Aguarde...</p>';
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: { ideal: 'environment' },
                        width: { ideal: 1280 },
                        height: { ideal: 960 }
                    } 
                });
                
                cameraWorking = true;
                stream.getTracks().forEach(track => track.stop());
                
                infoDiv.innerHTML = `
                    <h3>‚úÖ C√¢mera OK!</h3>
                    <p>Agora aponte para o <strong>marcador Hiro</strong></p>
                    <button onclick="showMarker()">üéØ Ver Marcador</button>
                    <button onclick="hideInfo()">‚ñ∂Ô∏è Come√ßar AR</button>
                `;
                
            } catch (error) {
                console.error('Erro c√¢mera:', error);
                infoDiv.innerHTML = `
                    <h3>‚ùå Erro na C√¢mera</h3>
                    <p><strong>Problema:</strong> ${error.message}</p>
                    <p><strong>Solu√ß√µes:</strong></p>
                    <ul style="text-align: left; font-size: 11px;">
                        <li>‚úÖ Clique em "Permitir" quando solicitado</li>
                        <li>‚úÖ Use HTTPS (GitHub Pages funciona)</li>
                        <li>‚úÖ Feche outros apps da c√¢mera</li>
                        <li>‚úÖ Use Chrome ou Firefox</li>
                    </ul>
                    <button onclick="location.reload()">üîÑ Recarregar</button>
                `;
            }
        }
        
        // Gerenciar carregamento dos modelos
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const gltfEntity = document.querySelector('#gltf-entity');
                const demoEntity = document.querySelector('#demo-entity');
                const fallbackCube = document.querySelector('#fallback-cube');
                const marker = document.querySelector('#hiro-marker');
                
                // Detectar marcador
                if (marker) {
                    marker.addEventListener('markerFound', () => {
                        console.log('üéØ Marcador Hiro encontrado!');
                        markerFound = true;
                    });
                    
                    marker.addEventListener('markerLost', () => {
                        console.log('‚ùå Marcador perdido');
                        markerFound = false;
                    });
                }
                
                // Tentativa principal: GLTF
                if (gltfEntity) {
                    gltfEntity.addEventListener('model-loaded', function() {
                        console.log('‚úÖ Modelo GLTF 1.glb carregado!');
                        modelLoaded = true;
                        updateStatus('‚úÖ Seu modelo 1.glb foi carregado com sucesso!');
                    });
                    
                    gltfEntity.addEventListener('model-error', function() {
                        console.log('‚ùå Erro no GLTF, usando demo...');
                        useDemoModel();
                    });
                }
                
                // Fun√ß√£o para usar modelo demo
                function useDemoModel() {
                    if (demoEntity) {
                        demoEntity.setAttribute('visible', true);
                        gltfEntity.setAttribute('visible', false);
                        updateStatus('üß™ Modelo de exemplo - Converta seu FBX');
                    }
                }
                
                function updateStatus(message) {
                    const infoDiv = document.getElementById('info');
                    infoDiv.innerHTML = `
                        <h3>üéÆ ${message}</h3>
                        <p>Aponte para o marcador Hiro</p>
                        <button onclick="showConverter()">üîÑ Converter</button>
                        <button onclick="hideInfo()">OK</button>
                    `;
                }
                
                // Verificar carregamento ap√≥s 5 segundos
                setTimeout(() => {
                    if (!modelLoaded) {
                        useDemoModel();
                    }
                }, 5000);
                
            }, 1000);
        });
        
        // Auto-inicializar teste da c√¢mera
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (!cameraWorking) {
                    testCamera();
                }
            }, 2000);
        });
        
        // For√ßar HTTPS se necess√°rio
        if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
            console.warn('‚ö†Ô∏è HTTPS necess√°rio para c√¢mera em dispositivos m√≥veis');
        }
    </script>
</body>
</html>
