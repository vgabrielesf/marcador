<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Modelo 3D AR - Vers√£o Universal</title>
    
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    
    <!-- A-Frame Extras para FBX/GLTF -->
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.loaders.min.js"></script>
    
    <!-- AR.js -->
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.min.js"></script>
    
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        
        #info {
            position: fixed; top: 10px; left: 10px; right: 10px;
            background: rgba(0, 0, 0, 0.9); color: white;
            padding: 15px; border-radius: 10px; z-index: 9999;
            font-size: 12px; text-align: center;
        }
        
        #info h3 { margin: 0 0 10px 0; color: #00ff88; }
        .hide { display: none; }
        button { 
            background: #ff4444; color: white; border: none;
            padding: 8px 16px; border-radius: 5px; margin: 5px; cursor: pointer;
        }
        .success { background: #28a745 !important; }
        .warning { background: #ffc107 !important; color: black !important; }
    </style>
</head>
<body>
    
    <div id="info">
        <h3>üéÆ Carregando Modelo 3D...</h3>
        <p>Verificando arquivo: <strong>1.fbx</strong></p>
        <button onclick="hideInfo()">OK</button>
        <button class="success" onclick="testCamera()">Testar C√¢mera</button>
        <button class="warning" onclick="showInstructions()">Instru√ß√µes</button>
    </div>

    <!-- Cena AR -->
    <a-scene 
        arjs='sourceType: webcam; trackingMethod: best; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: false;' 
        embedded
        vr-mode-ui="enabled: false">
        
        <!-- Assets -->
        <a-assets>
            <!-- Modelo FBX Principal -->
            <a-asset-item id="fbx-model" src="1.fbx"></a-asset-item>
            
            <!-- Modelos alternativos (caso existam) -->
            <a-asset-item id="gltf-model" src="1.glb"></a-asset-item>
            <a-asset-item id="obj-model" src="1.obj"></a-asset-item>
        </a-assets>
        
        <a-marker preset='hiro'>
            
            <!-- Container principal do modelo -->
            <a-entity id="model-container" position="0 0 0">
                
                <!-- Modelo FBX (tentativa principal) -->
                <a-entity 
                    id="fbx-entity"
                    fbx-model="src: #fbx-model"
                    position="0 0 0" 
                    rotation="0 0 0" 
                    scale="1 1 1"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 15000;"
                    visible="true">
                </a-entity>
                
                <!-- Modelo GLTF (backup 1) -->
                <a-entity 
                    id="gltf-entity"
                    gltf-model="src: #gltf-model"
                    position="0 0 0" 
                    rotation="0 0 0" 
                    scale="1 1 1"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 15000;"
                    visible="false">
                </a-entity>
                
                <!-- Cubo de fallback (backup 2) -->
                <a-box 
                    id="fallback-cube"
                    position="0 0.5 0" 
                    scale="0.8 0.8 0.8" 
                    color="#FF6B6B"
                    material="metalness: 0.3; roughness: 0.4;"
                    animation="property: rotation; to: 360 360 360; loop: true; dur: 8000;"
                    visible="false">
                    
                    <a-text 
                        value="MODELO\nNAO\nENCONTRADO" 
                        position="0 0 0.51" 
                        align="center" 
                        color="white" 
                        scale="0.4 0.4 0.4">
                    </a-text>
                </a-box>
                
            </a-entity>
            
            <!-- Ilumina√ß√£o otimizada para modelos 3D -->
            <a-light type="ambient" color="#404040" intensity="0.4"></a-light>
            <a-light type="directional" position="2 4 2" color="white" intensity="0.8"></a-light>
            <a-light type="point" position="-2 2 2" color="#4ECDC4" intensity="0.3"></a-light>
            
        </a-marker>
        
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        let modelLoaded = false;
        let cameraWorking = false;
        
        function hideInfo() {
            document.getElementById('info').classList.add('hide');
        }
        
        function showInstructions() {
            document.getElementById('info').innerHTML = `
                <h3>üìã Como usar o Modelo 3D AR:</h3>
                <p><strong>Arquivos suportados:</strong></p>
                <ul style="text-align: left; font-size: 11px;">
                    <li>1.fbx (formato FBX)</li>
                    <li>1.glb (formato GLTF - recomendado)</li>
                    <li>1.obj (formato OBJ)</li>
                </ul>
                <p><strong>Requisitos:</strong></p>
                <ul style="text-align: left; font-size: 11px;">
                    <li>Arquivo deve estar no mesmo reposit√≥rio</li>
                    <li>Tamanho m√°ximo: ~10MB</li>
                    <li>Use HTTPS (GitHub Pages)</li>
                    <li>Marcador Hiro impresso</li>
                </ul>
                <button onclick="hideInfo()">OK</button>
                <button onclick="testCamera()">Testar C√¢mera</button>
            `;
        }
        
        async function testCamera() {
            const infoDiv = document.getElementById('info');
            try {
                infoDiv.innerHTML = '<h3>üîç Testando c√¢mera...</h3>';
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: { ideal: 'environment' } } 
                });
                
                cameraWorking = true;
                stream.getTracks().forEach(track => track.stop());
                
                infoDiv.innerHTML = `
                    <h3>‚úÖ C√¢mera funcionando!</h3>
                    <p>Agora aponte para o marcador Hiro</p>
                    <button onclick="hideInfo()">Come√ßar AR</button>
                `;
                
            } catch (error) {
                infoDiv.innerHTML = `
                    <h3>‚ùå Erro na c√¢mera</h3>
                    <p>${error.message}</p>
                    <button onclick="location.reload()">Recarregar</button>
                `;
            }
        }
        
        // Gerenciar carregamento dos modelos
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const fbxEntity = document.querySelector('#fbx-entity');
                const gltfEntity = document.querySelector('#gltf-entity');
                const fallbackCube = document.querySelector('#fallback-cube');
                
                // Tentativa 1: FBX
                if (fbxEntity) {
                    fbxEntity.addEventListener('model-loaded', function() {
                        console.log('‚úÖ Modelo FBX carregado!');
                        modelLoaded = true;
                        updateStatus('Modelo FBX carregado com sucesso!');
                    });
                    
                    fbxEntity.addEventListener('model-error', function() {
                        console.log('‚ùå FBX falhou, tentando GLTF...');
                        tryGLTF();
                    });
                }
                
                // Tentativa 2: GLTF
                function tryGLTF() {
                    if (gltfEntity) {
                        gltfEntity.setAttribute('visible', true);
                        fbxEntity.setAttribute('visible', false);
                        
                        gltfEntity.addEventListener('model-loaded', function() {
                            console.log('‚úÖ Modelo GLTF carregado!');
                            modelLoaded = true;
                            updateStatus('Modelo GLTF carregado como alternativa!');
                        });
                        
                        gltfEntity.addEventListener('model-error', function() {
                            console.log('‚ùå GLTF tamb√©m falhou, usando fallback...');
                            useFallback();
                        });
                    } else {
                        useFallback();
                    }
                }
                
                // Tentativa 3: Fallback
                function useFallback() {
                    if (fallbackCube) {
                        fallbackCube.setAttribute('visible', true);
                        fbxEntity.setAttribute('visible', false);
                        gltfEntity.setAttribute('visible', false);
                        updateStatus('Arquivo 1.fbx n√£o encontrado. Usando modelo de exemplo.');
                    }
                }
                
                function updateStatus(message) {
                    const infoDiv = document.getElementById('info');
                    infoDiv.innerHTML = `
                        <h3>üéÆ ${message}</h3>
                        <p>Aponte a c√¢mera para o marcador Hiro</p>
                        <button onclick="hideInfo()">OK</button>
                    `;
                }
                
                // Verificar carregamento ap√≥s 5 segundos
                setTimeout(() => {
                    if (!modelLoaded) {
                        console.log('‚ö†Ô∏è Nenhum modelo carregou, usando fallback...');
                        useFallback();
                    }
                }, 5000);
                
                // Detectar marcador
                const marker = document.querySelector('a-marker');
                if (marker) {
                    marker.addEventListener('markerFound', () => {
                        console.log('üéØ Marcador encontrado!');
                    });
                }
                
            }, 2000);
        });
        
        // Auto-inicializar
        window.addEventListener('load', () => {
            setTimeout(() => testCamera(), 1000);
        });
    </script>
</body>
</html>
